# File generated by Chef, please do no edit by hand.
# Simple configuration for a replicated server

# RAID 1
# TRANSPORT-TYPE tcp
<% @servers.each do |server| %>

volume <%= server[:fqdn] %>-1
    type protocol/client
    option transport-type tcp
    option remote-host <%= server[:fqdn] %>
    option transport.socket.nodelay on
    option transport.remote-port 6996
    option remote-subvolume brick1
end-volume

<% end %>

volume mirror-0
    type cluster/replicate
    subvolumes <%= @servers.map { |server| server[:fqdn] + "-1 " } %>
end-volume

volume writebehind
    type performance/write-behind
    option cache-size 4MB
    subvolumes mirror-0
end-volume

volume readahead
    type performance/read-ahead
    option page-count 4
    subvolumes writebehind
end-volume

volume iocache
    type performance/io-cache
    option cache-size `grep 'MemTotal' /proc/meminfo  | awk '{print $2 * 0.2 / 1024}' | cut -f1 -d.`MB
    option cache-timeout 1
    subvolumes readahead
end-volume

volume quickread
    type performance/quick-read
    option cache-timeout 1
    option max-file-size 64kB
    subvolumes iocache
end-volume

volume statprefetch
    type performance/stat-prefetch
    subvolumes quickread
end-volume


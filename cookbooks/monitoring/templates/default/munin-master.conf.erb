# Example configuration file for Munin, generated by 'make build'

# The next three variables specifies where the location of the RRD
# databases, the HTML output, and the logs, severally.  They all
# must be writable by the user running munin-cron.
dbdir   /var/lib/munin
htmldir /var/www/munin
logdir  /var/log/munin
rundir  /var/run/munin

# Where to look for the HTML templates
tmpldir /etc/munin/templates

# Make graphs show values per minute instead of per second
#graph_period minute

# Drop somejuser@fnord.comm and anotheruser@blibb.comm an email everytime 
# something changes (OK -> WARNING, CRITICAL -> OK, etc)
#contact.someuser.command mail -s "Munin notification" somejuser@fnord.comm
#contact.anotheruser.command mail -s "Munin notification" anotheruser@blibb.comm
#
# For those with Nagios, the following might come in handy. In addition,
# the services must be defined in the Nagios server as well.
#contact.nagios.command /usr/sbin/send_nsca -H nagios.host.com -c /etc/send_nsca.cfg

# a simple host tree

<% @nodes.each do |n| %>
<% n[:network][:interfaces][:eth1][:addresses].each do |address,params| %>
  <% if params[:family].eql?("inet") %>
[<%= n[:fqdn] %>]
  address <%= address %>
  use_node_name no
   <% end %>
  <% end %>
<% end %>

<% parameters={"load" => "load.load", "apache_processes" => "apache_processes.busy80", "apache_acceses" => "apache_accesses:accesses80", "apache_memory" => "passenger_memory:apache_memory", "passenger_memory" => "passenger_memory:passenger_memory" ,"passenger_stats" => "passenger_stats:running" } %>

<% @domains.each do |domain,nodes| %>
[<%= domain %>;Combined]
   update no

<% parameters.each do |p,value| %>
   <%= p %>_combined.graph_category <%= p.capitalize %>
   <%= p %>_combined.graph_title <%= p.capitalize %> side by side
   <%= p %>_combined.graph_order <%= nodes.map {|n| Domainatrix.parse("http://"+n[:fqdn]).subdomain + "=" + n[:fqdn] +":#{p} "} %>

<% end %>
<% end %>
